{"version":3,"file":"live-announcer.spec.js","sourceRoot":"","sources":["file:///C:/projects/material2/tmp/broccoli_type_script_compiler-input_base_path-2PVWyBBf.tmp/0/src/demo-app/core/a11y/live-announcer.spec.ts"],"names":[],"mappings":"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","sourcesContent":["import {\r\n  inject,\r\n  fakeAsync,\r\n  flushMicrotasks,\r\n  tick,\r\n  addProviders,\r\n  getTestInjector\r\n} from '@angular/core/testing';\r\nimport {TestComponentBuilder, ComponentFixture} from '@angular/compiler/testing';\r\nimport {Component} from '@angular/core';\r\nimport {By} from '@angular/platform-browser';\r\nimport {MdLiveAnnouncer, LIVE_ANNOUNCER_ELEMENT_TOKEN} from './live-announcer';\r\n\r\ndescribe('MdLiveAnnouncer', () => {\r\n  let live: MdLiveAnnouncer;\r\n  let builder: TestComponentBuilder;\r\n  let liveEl: Element;\r\n\r\n  beforeEach(() => {\r\n    addProviders([\r\n      MdLiveAnnouncer,\r\n    ]);\r\n  });\r\n\r\n  beforeEach(inject([TestComponentBuilder, MdLiveAnnouncer],\r\n    (tcb: TestComponentBuilder, _live: MdLiveAnnouncer) => {\r\n      builder = tcb;\r\n      live = _live;\r\n      liveEl = getLiveElement();\r\n    }));\r\n\r\n  afterEach(() => {\r\n    // In our tests we always remove the current live element, because otherwise we would have\r\n    // multiple live elements due multiple service instantiations.\r\n    liveEl.parentNode.removeChild(liveEl);\r\n  });\r\n\r\n  it('should correctly update the announce text', fakeAsyncTest(() => {\r\n    let appFixture: ComponentFixture<TestApp> = null;\r\n\r\n    builder.createAsync(TestApp).then(fixture => {\r\n      appFixture = fixture;\r\n    });\r\n\r\n    flushMicrotasks();\r\n\r\n    let buttonElement = appFixture.debugElement\r\n      .query(By.css('button')).nativeElement;\r\n\r\n    buttonElement.click();\r\n\r\n    // This flushes our 100ms timeout for the screenreaders.\r\n    tick(100);\r\n\r\n    expect(liveEl.textContent).toBe('Test');\r\n  }));\r\n\r\n  it('should correctly update the politeness attribute', fakeAsyncTest(() => {\r\n    let appFixture: ComponentFixture<TestApp> = null;\r\n\r\n    builder.createAsync(TestApp).then(fixture => {\r\n      appFixture = fixture;\r\n    });\r\n\r\n    flushMicrotasks();\r\n\r\n    live.announce('Hey Google', 'assertive');\r\n\r\n    // This flushes our 100ms timeout for the screenreaders.\r\n    tick(100);\r\n\r\n    expect(liveEl.textContent).toBe('Hey Google');\r\n    expect(liveEl.getAttribute('aria-live')).toBe('assertive');\r\n  }));\r\n\r\n  it('should apply the aria-live value polite by default', fakeAsyncTest(() => {\r\n    let appFixture: ComponentFixture<TestApp> = null;\r\n\r\n    builder.createAsync(TestApp).then(fixture => {\r\n      appFixture = fixture;\r\n    });\r\n\r\n    flushMicrotasks();\r\n\r\n    live.announce('Hey Google');\r\n\r\n    // This flushes our 100ms timeout for the screenreaders.\r\n    tick(100);\r\n\r\n    expect(liveEl.textContent).toBe('Hey Google');\r\n    expect(liveEl.getAttribute('aria-live')).toBe('polite');\r\n  }));\r\n\r\n  it('should allow to use a custom live element', fakeAsyncTest(() => {\r\n    let customLiveEl = document.createElement('div');\r\n\r\n    // We need to reset our test injector here, because it is already instantiated above.\r\n    getTestInjector().reset();\r\n\r\n    getTestInjector().addProviders([\r\n      {provide: LIVE_ANNOUNCER_ELEMENT_TOKEN, useValue: customLiveEl},\r\n      MdLiveAnnouncer\r\n    ]);\r\n\r\n    let injector = getTestInjector().createInjector();\r\n    let liveService: MdLiveAnnouncer = injector.get(MdLiveAnnouncer);\r\n\r\n    liveService.announce('Custom Element');\r\n\r\n    // This flushes our 100ms timeout for the screenreaders.\r\n    tick(100);\r\n\r\n    expect(customLiveEl.textContent).toBe('Custom Element');\r\n  }));\r\n\r\n});\r\n\r\nfunction fakeAsyncTest(fn: () => void) {\r\n  return inject([], fakeAsync(fn));\r\n}\r\n\r\nfunction getLiveElement(): Element {\r\n  return document.body.querySelector('.md-live-announcer');\r\n}\r\n\r\n@Component({\r\n  selector: 'test-app',\r\n  template: `<button (click)=\"announceText('Test')\">Announce</button>`,\r\n})\r\nclass TestApp {\r\n\r\n  constructor(private live: MdLiveAnnouncer) {\r\n  };\r\n\r\n  announceText(message: string) {\r\n    this.live.announce(message);\r\n  }\r\n\r\n}\r\n\r\n"]}